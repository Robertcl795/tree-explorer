<div
  class="tree-item"
  [class.disabled]="row().disabled"
  [class.error]="row().error"
  [style.padding-left.px]="leftPadding()"
  [attr.data-tree-row-id]="row().id"
  [attr.tabindex]="row().disabled ? null : 0"
  [attr.draggable]="dragDropEnabled() && !row().disabled ? true : null"
  (click)="rowClick.emit($event)"
  (dblclick)="rowDoubleClick.emit($event)"
  (contextmenu)="onContextMenu($event)"
  (dragstart)="onDragStart($event)"
  (dragover)="onDragOver($event)"
  (drop)="onDrop($event)"
  (dragend)="onDragEnd($event)"
>
  @if (row().loading) {
    <cv-circular-progress
      indeterminate
      class="row-spinner"
      aria-label="Loading tree row"></cv-circular-progress>
  }
  <div class="item-content">
    <!-- Expand/Collapse button (always present for alignment) -->
    <cv-icon-button
      class="caret-button"
      [disabled]="row().isLeaf"
      [style.visibility]="row().isLeaf ? 'hidden' : 'visible'"
      [icon]="row().expanded ? 'expand_more' : 'chevron_right'"
      (click)="onExpandClick($event)"
      (keydown.enter)="onExpandClick($event)"
      (contextmenu)="$event.stopPropagation()">
    </cv-icon-button>
    <!-- Checkbox for selection -->
    @if (showCheckbox()) {
      <div
        class="checkbox-wrapper"
        (contextmenu)="$event.stopPropagation()">
        <cv-checkbox
          class="tree-item-checkbox"
          [checked]="row().selected"
          [indeterminate]="row().indeterminate"
          [disabled]="row().disabled"
          (change)="onSelectClick($event)"
          (click)="$event.stopPropagation()"></cv-checkbox>
      </div>
    }
    <!-- Icon and label -->
    @if (display().showIcons && row().icon) {
      <cv-icon class="tree-item-icon" aria-hidden="true">{{ row().icon }}</cv-icon>
    }
    @if (row().placeholder) {
      <span class="tree-item-placeholder" aria-hidden="true"></span>
      <span class="tree-item-label placeholder-text">{{ row().label }}</span>
    } @else {
      <span
        class="tree-item-label"
        [innerHTML]="row().label | treeHighlightMatch: filterQuery() : row().highlightRanges"></span>
    }
    <!-- Spacer -->
    <div class="tree-item--spacer"></div>
    <!-- Context menu -->
    @if (showContextButton() && !row().disabled) {
      <cv-icon-button
        class="context-menu-button"
        icon="more_vert"
        (click)="onContextButtonClick($event)">
      </cv-icon-button>
    }
  </div>
</div>
